<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <title>Project Wrap-Up &mdash; BITtailor @ Eclipse Open IoT Challenge</title>
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="stylesheet" href="/assets/prism.css">
    <link rel="shortcut icon" href="/favicon.png" type="image/png" />
    <link rel="apple-touch-icon" href="/images/logo.jpg"/>
    <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="BITtailor @ Eclipse Open IoT Challenge" />
    <meta name="title" content="Project Wrap-Up ">
    <link rel="canonical" href="http://incorporated.sendtoinc.com/2016/02/26/oiot2-project-wrap-up/">
    
    
    <meta property="og:title" content="Project Wrap-Up "/>
    <meta property="og:url" content="http://incorporated.sendtoinc.com/2016/02/26/oiot2-project-wrap-up/"/>
    
    <meta property="og:image" content="http://incorporated.sendtoinc.com/images/mountain_3.jpg"/>
    
    <meta property="og:image" content="http://incorporated.sendtoinc.com/images/logo.jpg"/>
    



    <meta property="og:site_name" content="BITtailor @ Eclipse Open IoT Challenge">

</head>
<body>
<section class="site-nav">
    <header>
        <nav id="navigation">
            <a class="brand" href="/">
              <i class="fa fa-home fa-2x"></i>  <i class="fa fa-plug fa-rotate-45"></i> <i class="fa fa-cloud fa-2x"></i>
              <!-- <img src="/images/logo.jpg" alt="Inc"> -->
            </a>
            <a href="/edition/second/">2.0</a>
            <a href="/edition/first">1.0</a>
            <a href="http://iot.eclipse.org/open-iot-challenge/">@Eclipse</a>
            <a href="http://openiotchallenge.tumblr.com">@tumblr</a>
        </nav>
    </header>
</section>


<div class="article-cover">
    <div>
        <img src="/images/mountain_3.jpg" class="image">
    </div>
</div>

<article>

    <div class="container">
        <header>
            <div class="meta">
                By <address><a rel="author" href="" title="BITtailor" target="_blank">BITtailor</a></address> &mdash;
                <time pubdate datetime="2016-26-February" title="February 26, 2016">February 26, 2016</time>
            </div>
            <h1 class="title">Project Wrap-Up</h1>
            <h2 class="subtitle">IoT-ing a mountain’s hut off-grid solar power system</h2>
        </header>

        <section>
            
<p>This is the final wrap-up post for my <a href="http://iot.eclipse.org/open-iot-challenge">Eclipse Open IoT Challenge 2.0</a> project. It will not be the last post about my Solar Monitor since I unfortunately was not able to completely finish my project till the end of the challenge. I’m still waiting for my PCB’s to arrive and also need to finish some software parts. But let’s start from the beginning …</p>

<!-- more -->
<p><a href="/2015/12/22/iot-challenge-2-0/">The idea</a> was to add extra sensors and connectivity to the off-grid solar power system of a mountain hut to gain more insides into the generated and used energy.</p>

<p><img src="/images/oiot2-idea-2.png" alt="off-grid solar power system" /></p>

<p>So as explained in the <a href="/2016/01/14/oiot2-first-steps/">first steps</a> post I started with boards and shields from my tinkering box and was able to setup a MQTT connection with the Paho client library. After the first steps a saw some issues with the Arduino UNO board and the GPRS Shield as explained in <a href="/2016/01/30/oiot2-conclusions-after-first-steps/">Conclusions after my first steps</a>. So I used my Adafruit voucher and ordered an <a href="https://www.adafruit.com/products/2772">Adafruit Feather M0</a> as main MCU and an <a href="https://www.adafruit.com/product/1946">Adafruit FONA</a> for GPRS. <a href="https://www.adafruit.com/product/1946">Adafruit FONA</a> provides an nice <a href="https://github.com/adafruit/Adafruit_FONA">library with GPRS support</a> and Adafruit also provides compatible <a href="https://github.com/adafruit/Adafruit_MQTT_Library">MQTT library</a>. But since this an eclipse challenge I implemented the <em><a href="https://github.com/bittailor/BtSolarMonitor/blob/master/Firmware/libraries/Bt_PahoWithFona_Library/src/Bt_PahoWithFona.h">PAHO Network Adapter</a></em> for the FONA GPRS library and with this was able to use the Paho client library.</p>

<pre><code class="language-c">Adafruit_FONA sFona(FONA_RST);
Bt_PahoNetworkFona sNetwork(sFona);
MQTT::Client&lt;Bt_PahoNetworkFona, Bt_PahoTimer, 500, 1&gt; sMqttClient(sNetwork);
</code></pre>

<p>After having prototyped the MQTT connection I also prototyped the dispay and the current sensor. So my protoboard looked like this:<br />
<img src="/images/proto_2.jpg" alt="proto_2.jpg" /></p>

<p>I then started to create the schematic and the board for my solar monitor PBC’s. I had to learn, one time more, that <strong>Hardware is Hard</strong>, at least for me how has an electrical engineering background, but is <em>only</em> doing software on the job for over 10 years. So I spent hours with detours on how to design the drivers so that I can drive the relays from a MCU pin and then some more hours to actually select the part form the 100’s that do the same. It’s kind of like choosing your javascript library there seem to be hundreds that do the same. So I lost a lot of time and this is why my PCB are not here yet. But at least I have some nice pictures:</p>

<p><img src="/images/SolarMonitorMainBoard.png" alt="SolarMonitorMainBoard" /></p>

<p>The main board it contains<br />
 - 1 <a href="https://www.adafruit.com/products/2772">Adafruit Feather M0</a> as main MCU<br />
 - 6 <a href="http://www.ti.com/lit/ds/symlink/ina219.pdf">INA219</a> current sensors<br />
 - 3  bistable relays (because I decided to also switch the load not just measure)<br />
 - 1 <a href="http://www.atmel.com/devices/atmega328p.aspx">ATmega328P</a> as slave MCU (because I run out of IO’s on the main MCU)<br />
 - 1 Darlington-Transistor-Arrays to drive the relays<br />
 - 1 5V voltage regulator</p>

<p>The main board is connected to a display board:</p>

<p><img src="/images/SolarMonitorDisplayBoard.png" alt="SolarMonitorDisplayBoard" /></p>

<p>The display board contains<br />
 - The <a href="https://www.adafruit.com/product/1946">Adafruit FONA</a><br />
 - 2 <a href="https://www.adafruit.com/products/338">Nokia 5110</a> displays<br />
 - <em>spare</em> connections for a barometric breakout and a temperature breakout</p>

<p>During the creation of the board I made some adoptions to my initial idea. Instead of just measuring I also included some actors. I decided that I would also like to be able to switch off the complete load and switch between the to batteries with the MCU and with this also from remote.</p>

<p><img src="/images/eiot-2-overview-2.png" alt="eiot-2-overview-2" /></p>

<p>After I sent the Gerbers for the PCB’s to the PCB service I focused back to the software parts.</p>

<p>I used <a href="https://io.adafruit.com">Adafruit.io</a> to create an online dashboard for my solar monitor.</p>

<p><img src="/images/Dashboard.png" alt="Dashboard" /></p>

<p>Since <a href="https://io.adafruit.com">Adafruit.io</a> supports MQTT out of the box this was straight forward.</p>

<p>The time for the second Eclipse Open IoT Challenge is up but I will keep going and finish my Solar Monitor.</p>

<p>All the hardware and software parts can be found in <a href="https://github.com/bittailor/BtSolarMonitor">this GitHub repository</a>.</p>

            

        </section>

        <footer>
            <address>
               <img src="/images/avatar.png">
                <p>Written by <strong><a rel="author" href="https://twitter.com/bittailor_ch" title="" target="_blank">BITtailor</a></strong><br>
                <span class="muted">passion for the bits and bytes</span>
                </p>
            </address>

        </footer>

        
        <section>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'bittailoriotchallenge'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
        </section>
        
    </div>
</article>


<footer class="site-footer">
    <div class="container">
        &copy; 2016

        <nav>
            <a href="http://bittailor.ch/">BITtailor</a> &middot;
            <a href="/">Blog</a> &middot;
            <a href="http://iot.eclipse.org/open-iot-challenge/">@Eclipse</a>
            <a href="http://openiotchallenge.tumblr.com">@tumblr</a>
        </nav>

        <nav class="social">
            
            <a href="https://twitter.com/bittailor_ch" title="Follow on Twitter" target="_blank">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle-thin fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x"></i>
              </span>
            </a>
            
            
            <a href="http://github.com/bittailor" title="Fork on Github" target="_blank">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle-thin fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x"></i>
              </span>
            </a>
            
            <a href="/feed.xml" title="RSS Feed">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle-thin fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x"></i>
              </span>
            </a>

        </nav>
    </div>
</footer>

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>







</body>
</html>
